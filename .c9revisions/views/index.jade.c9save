{"ts":1363301414467,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"extends layout\r\n\r\nblock head\r\n    link(rel='stylesheet', type='text/css', href='/stylesheets/siteV1.css')\r\n    link(rel='stylesheet', type='text/css', href='/stylesheets/popupPanel.css')\r\n    script(type='text/javascript', src='/scripts/appContentPopup.js')\r\n    script(type='text/javascript', src='/scripts/appMasonry.js')\r\n    script(type='text/javascript', src='/scripts/jquery.textareaExpander.js')\r\n    script(type='text/javascript', src='/scripts/buzz.js')\r\n    script(type='text/javascript')\r\n        var apiBasePath = '#{apiBasePath}',\r\n            isMobile = #{isMobile};\r\n        var fileBasePath = apiBasePath + '/file/',\r\n            //postBasePath = apiBasePath + '/postUpdate/',\r\n            isLoading = false,\r\n            popupPostId = '',\r\n            popupTitle = null,\r\n            popupDetails = null,\r\n            rolloverSound = null,\r\n            popupDetailsExpandEvent = 'textareaExpandTriggered';\r\n\r\n        var reloadPosts = function(data){\r\n            isLoading = true;\r\n            $.each(data, function(key, value){\r\n                //postItem(urlMainImage, details, title, postId, actions, comments)\r\n                postItem(fileBasePath + value.ImageFileId, value.Message, value.Title, value._id) ;\r\n            });\r\n            document.loadMasonry();\r\n            $('.pic img').mouseenter(function(){\r\n                rolloverSound.play();\r\n            });\r\n            $('.pic img').mouseleave(function(){\r\n                rolloverSound.stop();\r\n            })\r\n\r\n        }\r\n        //need to protect masonry \r\n        $(function(){\r\n            var $container = $('#column');\r\n\r\n            document.loadMasonry = function(){\r\n                $container.imagesLoaded(function () {\r\n                    $container.masonry({\r\n                        itemSelector: '.box',\r\n                        columnWidth: 0,\r\n                        isAnimated: true,\r\n                        animationOptions: {\r\n                            duration: 400\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n\r\n            document.savePost = function(postId, title, details, imageFileId, sessionId, callback ){\r\n                var data = {\r\n                    title: title,\r\n                    message: details,\r\n                    imageFileId: imageFileId,\r\n                    sessionId: sessionId\r\n                };\r\n                $.post(apiBasePath + '/postUpdate/' + postId, data).error(function(){\r\n                    callback(new Error('save failed') );\r\n                });\r\n                document.updateBrick(postId, title, details);\r\n            }\r\n\r\n            document.updateBrick = function(postId, title, details){\r\n                var brick = $('div[postId=' + postId + ']');\r\n                var dDetails = $('<p/>').append(details.replace(/(\\\\r\\\\n|\\\\n|\\\\r)/g, \"<br />\"));\r\n                dDetails.attr('value', details);\r\n                brick.find('div.details p').replaceWith( dDetails ) ;\r\n            }\r\n\r\n            document.toSavePost = function(){\r\n                document.savePost(popupPostId, popupTitle.val(), popupDetails.val(), null, null, function(err, status){\r\n                    if (err) alert(err);\r\n                });\r\n                document.loadMasonry();\r\n            };\r\n        });\r\n        $(document).ready(function(){\r\n            popupTitle = $('div#popupBody div.popupContent h2 input[name=\"title\"]');\r\n            popupDetails = $('div#popupBody div.popupContent div.details textarea[name=\"details\"]');\r\n            popupDetails.textareaExpander({expandEventName:popupDetailsExpandEvent, animate: false });\r\n            popupDetails.blur(document.toSavePost);\r\n            popupTitle.blur(document.toSavePost);\r\n            rolloverSound = new buzz.sound(\"/media/rollover\",{formats:[\"ogg\",\"mp3\"],preload:true});\r\n            rolloverSound.setVolume(60);\r\n            rolloverSound.setSpeed(1.2);\r\n            if (isMobile) {\r\n                var viewPort = document.createElement('meta');\r\n                viewPort.name = 'viewport';\r\n                viewPort.content = 'width=device-width, initial-scale=1.0';\r\n                document.head.appendChild(viewPort);\r\n            }\r\n            //TODO: replace with Session\r\n            //$.support.cors = true;\r\n            $.ajax({\r\n                url: apiBasePath + \"/postList/50b198cfaee84a500f000001\", \r\n                type: 'GET',\r\n                crossDomain: true,\r\n                error: function(xhr, status, err){\r\n                    alert(status + err);\r\n                },\r\n                success: reloadPosts, \r\n                dataType : \"json\", \r\n                cache: false\r\n            });\r\n\r\n            /*\r\n            if (!isLoading){\r\n                var postList = document.createElement('script');\r\n                postList.type = 'text/javascript';\r\n                postList.src = apiBasePath + '/postList/50b198cfaee84a500f000001?callback=reloadPosts';\r\n                document.head.appendChild(postList);\r\n                document.head.removeChild(postList);\r\n            }*/\r\n\r\n        });\r\n\r\n\r\nblock content\r\n\r\n    div#column.clearfix\r\n\r\n    div#pp\r\n\r\n    div#popupContact\r\n        div#popupBg\r\n        div#ppHeadBg\r\n        a#popupContactClose x\r\n        div#popupBody\r\n            h1 owner (username)\r\n            div.popupPic\r\n                img#popupImg\r\n            div.popupContent\r\n                h2\r\n                    input(type='text',name='title')\r\n                hr\r\n                div.details\r\n                    div#detailsViewer\r\n                        div#inner\r\n                    textarea(name='details')\r\n                div.popupComment.fragment tags here\r\n                div.popupComment.fragment comments here\r\n                div.popupComment.fragment comments here\r\n            div#ppControl\r\n                a(href='')\r\n                    img(src='http://cdn-img.easyicon.cn/png/5781/578152.gif', style='width:27px')\r\n                br\r\n                a(href='')\r\n                    img(src='http://cdn-img.easyicon.cn/png/10697/1069720.gif', style='width:27px')\r\n                br\r\n                a(href='')\r\n                    img(src='http://cdn-img.easyicon.cn/png/54/5420.gif', style='width:27px')\r\n                br\r\n                a(href='')\r\n                    img(src='http://cdn-img.easyicon.cn/png/5490/549052.gif', style='width:27px')\r\n    div#backgroundPopup\r\n///\r\n    div#popupPanel\r\n        div#ppBg\r\n        a#ppClose x\r\n        div#ppBody\r\n    div#ppBackdrop\r\n"]],"start1":0,"start2":0,"length1":0,"length2":6528}]],"length":6528}
