{"ts":1361516363860,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"extends layout\r\nblock head\r\n    link(rel='stylesheet', type='text/css', href='/stylesheets/siteV1.css')\r\n    link(rel='stylesheet', type='text/css', href='/stylesheets/upload.css')\r\n    script(type='text/javascript', src='/scripts/jquery.filedrop.js')\r\n    script(type='text/javascript', src='/scripts/curl.js')\r\n    script(type='text/javascript')\r\n        var isMobile = #{isMobile};\r\n        $(function(){\r\n            curl({\r\n                baseUrl:'scripts'\r\n            });\r\n\r\n            var dropbox = $('#dropbox'),\r\n                message = $('.message', dropbox);\r\n                \r\n            /*var addImagePost = function(){\r\n            }*/\r\n            curl(['modules/mobileViewPort']).then(function (viewPort) {\r\n                viewPort.isMobile = isMobile;\r\n                viewPort.set();\r\n            });\r\n\r\n            dropbox.filedrop({\r\n                // The name of the $_FILES entry:\r\n                paramname:'pic',\r\n                maxfiles: 100,\r\n                maxfilesize: 10,\r\n                url: '#{apiBasePath}/upload',\r\n                uploadFinished: function(i,file,response){\r\n                    //$.data(file).find('.progress').width('100%');\r\n                    $.data(file).addClass('done');\r\n                    // response is the JSON object that post_file.php returns\r\n                },\r\n                error: function(err, file) {\r\n                    switch(err) {\r\n                        case 'BrowserNotSupported':\r\n                            showMessage('Your browser does not support HTML5 file uploads!');\r\n                            break;\r\n                        case 'TooManyFiles':\r\n                            alert('Too many files! Please select 100 at most! (configurable)');\r\n                            break;\r\n                        case 'FileTooLarge':\r\n                            alert(file.name + ' is too large! Please upload files up to 2mb (configurable).');\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                },\r\n                uploadStarted:function(i, file, len){\r\n                    createImage(file);\r\n                },\r\n                progressUpdated: function(i, file, progress) {\r\n                    $.data(file).find('.progress').width(progress + '%');\r\n                }\r\n            });\r\n            var template = '<div class=\"preview\">'+\r\n                                '<span class=\"imageHolder\">'+\r\n                                    '<img />'+\r\n                                    '<span class=\"uploaded\"></span>'+\r\n                                '</span>'+\r\n                                '<div class=\"progressHolder\">'+\r\n                                    '<div class=\"progress\"></div>'+\r\n                                '</div>'+\r\n                            '</div>';\r\n            function createImage(file){\r\n                var preview = $(template), \r\n                    image = $('img', preview);\r\n                var reader = new FileReader();\r\n                image.width = '100%';\r\n                image.height = '100%';\r\n                reader.onload = function(e){\r\n                    // e.target.result holds the DataURL which\r\n                    // can be used as a source of the image:\r\n                    image.attr('src',e.target.result);\r\n                };\r\n                // Reading the file as a DataURL. When finished,\r\n                // this will trigger the onload function above:\r\n                reader.readAsDataURL(file);\r\n                message.hide();\r\n                //preview.appendTo( $('#result') );\r\n                preview.appendTo(dropbox);\r\n\r\n                // Associating a preview container\r\n                // with the file, using jQuery's $.data():\r\n                $.data(file,preview);\r\n            }\r\n            function showMessage(msg){\r\n                message.html(msg);\r\n            }\r\n        });\r\n\r\n\r\nblock content\r\n\r\n    div#dropbox\r\n        span.message Drop images here to upload\r\n            br\r\n    div#result\r\n"]],"start1":0,"start2":0,"length1":0,"length2":4081}]],"length":4081}
