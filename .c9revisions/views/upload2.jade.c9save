{"ts":1361516363860,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"extends layout\r\nblock head\r\n    link(rel='stylesheet', type='text/css', href='/stylesheets/siteV1.css')\r\n    link(rel='stylesheet', type='text/css', href='/stylesheets/upload.css')\r\n    script(type='text/javascript', src='/scripts/jquery.filedrop.js')\r\n    script(type='text/javascript', src='/scripts/curl.js')\r\n    script(type='text/javascript')\r\n        var isMobile = #{isMobile};\r\n        $(function(){\r\n            curl({\r\n                baseUrl:'scripts'\r\n            });\r\n\r\n            var dropbox = $('#dropbox'),\r\n                message = $('.message', dropbox);\r\n                \r\n            /*var addImagePost = function(){\r\n            }*/\r\n            curl(['modules/mobileViewPort']).then(function (viewPort) {\r\n                viewPort.isMobile = isMobile;\r\n                viewPort.set();\r\n            });\r\n\r\n            dropbox.filedrop({\r\n                // The name of the $_FILES entry:\r\n                paramname:'pic',\r\n                maxfiles: 100,\r\n                maxfilesize: 10,\r\n                url: '#{apiBasePath}/upload',\r\n                uploadFinished: function(i,file,response){\r\n                    //$.data(file).find('.progress').width('100%');\r\n                    $.data(file).addClass('done');\r\n                    // response is the JSON object that post_file.php returns\r\n                },\r\n                error: function(err, file) {\r\n                    switch(err) {\r\n                        case 'BrowserNotSupported':\r\n                            showMessage('Your browser does not support HTML5 file uploads!');\r\n                            break;\r\n                        case 'TooManyFiles':\r\n                            alert('Too many files! Please select 100 at most! (configurable)');\r\n                            break;\r\n                        case 'FileTooLarge':\r\n                            alert(file.name + ' is too large! Please upload files up to 2mb (configurable).');\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                },\r\n                uploadStarted:function(i, file, len){\r\n                    createImage(file);\r\n                },\r\n                progressUpdated: function(i, file, progress) {\r\n                    $.data(file).find('.progress').width(progress + '%');\r\n                }\r\n            });\r\n            var template = '<div class=\"preview\">'+\r\n                                '<span class=\"imageHolder\">'+\r\n                                    '<img />'+\r\n                                    '<span class=\"uploaded\"></span>'+\r\n                                '</span>'+\r\n                                '<div class=\"progressHolder\">'+\r\n                                    '<div class=\"progress\"></div>'+\r\n                                '</div>'+\r\n                            '</div>';\r\n            function createImage(file){\r\n                var preview = $(template), \r\n                    image = $('img', preview);\r\n                var reader = new FileReader();\r\n                image.width = '100%';\r\n                image.height = '100%';\r\n                reader.onload = function(e){\r\n                    // e.target.result holds the DataURL which\r\n                    // can be used as a source of the image:\r\n                    image.attr('src',e.target.result);\r\n                };\r\n                // Reading the file as a DataURL. When finished,\r\n                // this will trigger the onload function above:\r\n                reader.readAsDataURL(file);\r\n                message.hide();\r\n                //preview.appendTo( $('#result') );\r\n                preview.appendTo(dropbox);\r\n\r\n                // Associating a preview container\r\n                // with the file, using jQuery's $.data():\r\n                $.data(file,preview);\r\n            }\r\n            function showMessage(msg){\r\n                message.html(msg);\r\n            }\r\n        });\r\n\r\n\r\nblock content\r\n\r\n    div#dropbox\r\n        span.message Drop images here to upload\r\n            br\r\n    div#result\r\n"]],"start1":0,"start2":0,"length1":0,"length2":4081}]],"length":4081}
{"contributors":[],"silentsave":false,"ts":1366570042866,"patch":[[{"diffs":[[0,"sMobile}"],[1,",\r\n            userId = #{userId}"],[0,";\r\n     "]],"start1":375,"start2":375,"length1":16,"length2":49},{"diffs":[[0,"}/upload"],[-1,"'"],[1,"/' + encodeURIComponent(userId)"],[0,",\r\n     "]],"start1":1080,"start2":1080,"length1":17,"length2":47}]],"length":4144,"saved":false}
{"ts":1366570102308,"patch":[[{"diffs":[[0,"vascript')\r\n"],[1,"\r\n"],[0,"        var "]],"start1":337,"start2":337,"length1":24,"length2":26}]],"length":4146,"saved":false}
{"ts":1366570126125,"patch":[[{"diffs":[[0,"ript')\r\n"],[-1,"\r\n"],[0,"        "]],"start1":341,"start2":341,"length1":18,"length2":16}]],"length":4144,"saved":false}
{"contributors":[],"silentsave":false,"ts":1366571040943,"patch":[[{"diffs":[[0,"serId = "],[1,"'"],[0,"#{userId"]],"start1":399,"start2":399,"length1":16,"length2":17},{"diffs":[[0,"{userId}"],[1,"'"],[0,";\r\n     "]],"start1":409,"start2":409,"length1":16,"length2":17}]],"length":4146,"saved":false}
{"contributors":[],"silentsave":false,"ts":1366691438764,"patch":[[{"diffs":[[0,"  \r\n"],[-1,"            /*var addImagePost = function(){\r\n            }*/\r\n"],[0,"    "]],"start1":625,"start2":625,"length1":71,"length2":8}]],"length":4083,"saved":false}
{"ts":1366691515083,"patch":[[{"diffs":[[0," curl(['"],[1,"/scripts/"],[0,"modules/"]],"start1":640,"start2":640,"length1":16,"length2":25}]],"length":4092,"saved":false}
{"ts":1366691591834,"patch":[[{"diffs":[[0,"load.css')\r\n"],[1,"    script(type='text/javascript', src='/scripts/underscore.min.js')\r\n    script(type='text/javascript', src='/scripts/backbone.min.js')\r\n"],[0,"    script(t"]],"start1":170,"start2":170,"length1":24,"length2":162}]],"length":4230,"saved":false}
